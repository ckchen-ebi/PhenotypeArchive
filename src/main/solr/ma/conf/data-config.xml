<dataConfig>

	<dataSource jndiName="java:comp/env/jdbc/ontodbDataSource" />

	<document name="komp2_indexing">	
		<!-- test MP:0000180 for multipe node_id being linked to this term -->
		<!-- IMPC pipeline -->							
		<entity name="ma_term_infos" query="select term_id, name, definition from ma_term_infos">				
			<field column="term_id" name="ma_id" />
            <field column="name" name="ma_term" />
            <field column="definition" name="ma_definition" />
			<entity name="ma_node2term" query="select node_id from ma_node2term where term_id='${ma_term_infos.term_id}'" >				
				<entity name="ma_node_top_level" query="select node_id, top_level_node_id from ma_node_top_level where node_id=${ma_node2term.node_id}" >
					<entity name="ma_node2term" query="select term_id from ma_node2term where node_id=${ma_node_top_level.top_level_node_id}" >
						<entity name="ma_dbxrefs" query="select xref_id from ma_dbxrefs where term_id='${ma_node2term.term_id}'" >
							<field column="xref_id" name="xref_id" />
						</entity>						
                        <entity name="ma_term_infos" query="select term_id, name, definition from ma_term_infos where term_id='${ma_node2term.term_id}'" >
							<field column="term_id" name="top_level_ma_id" />
           					<field column="name" name="top_level_ma_term" />
            				<field column="definition" name="top_level_ma_definition" />
						</entity>
					</entity>
					<!-- continue with null value for top_level_id from part_of relationship -->
					<entity name="ma_node_top_level_part_of"  onError="continue" query="select top_level_node_id from ma_node_top_level_part_of where node_id=${ma_node_top_level.node_id}" >
						<entity name="ma_node2term" query="select term_id from ma_node2term where node_id=${ma_node_top_level_part_of.top_level_node_id}" >
							<entity name="ma_dbxrefs" query="select xref_id from ma_dbxrefs where term_id='${ma_node2term.term_id}'" >
								<field column="xref_id" name="xref_id_part_of" />
							</entity>						
                        	<entity name="ma_term_infos" query="select term_id, name, definition from ma_term_infos where term_id='${ma_node2term.term_id}'" >
								<field column="term_id" name="top_level_ma_id_part_of" />
           						<field column="name" name="top_level_ma_term_part_of" />
            					<field column="definition" name="top_level_ma_definition_part_of" />
							</entity>
						</entity>
					</entity>
				</entity>			
			</entity>
			<entity name="ma_synonyms" query="select syn_name from ma_synonyms where term_id = '${ma_term_infos.term_id}'">				
				<field column="syn_name" name="ma_term_synonym" />
            </entity>
		</entity>	
	</document>

</dataConfig>
